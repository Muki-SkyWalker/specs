<html>
    <head>
      <title>Spies</title>
        <style type="text/css" media="all">
          @import url('./css/maven-base.css');
          @import url('./css/maven-theme.css');
          @import url('./css/site.css');
        </style>
        <link href="./css/prettify.css" rel="stylesheet" type="text/css"></link>
        <script type="text/javascript" src="./css/prettify.js"></script>
        <link href="./css/print.css" type="text/css" rel="stylesheet" media="print"></link>
        <link href="./css/tooltip.css" type="text/css" rel="stylesheet"></link>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <script type="text/javascript" src="./css/tooltip.js"></script>
        <script language="javascript"> function init() { prettyPrint();noNavBar()}
    // found on : http://www.tek-tips.com/faqs.cfm?fid=6620
    String.prototype.endsWith = function(str) { return (this.match(str+'$') == str) }

    function changeWidth(id,width) {
      document.getElementById(id).style.width = width;
    }
    function changeMarginLeft(id, margin) {
      document.getElementById(id).style.marginLeft = margin;
    }
    function noNavBar() {
      changeWidth('leftColumn','0px');
      document.getElementById('leftColumn').style.visibility = 'hidden'; 
      document.getElementById('leftColumn').style.display = 'none'; 
      changeMarginLeft('bodyColumn', '35px')
   }
   function toggleNavBar(image) {
      toggleImage(image)
      if (image.src.endsWith('images/expanded.gif')) {
        changeWidth('leftColumn','20px');
        changeMarginLeft('bodyColumn', '35px')
      }
    else {
        changeWidth('leftColumn','250px');
        changeMarginLeft('bodyColumn', '277px')
      }
   }
   function toggleImage(image) {
      if (image.src.endsWith('images/expanded.gif')) {
        image.src = 'images/collapsed.gif';
      }
    else {
        image.src = 'images/expanded.gif';
      }
   }
    function showHideTable(tableId) {
      table = document.getElementById(tableId)
      table.style.display = (table.style.display == 'none')? 'block' : 'none';
    }
    function showExampleMessage(status, exId, event) {
    exampleMessage = document.getElementById('rowmess:' + exId)
    exampleIcon = document.getElementById('rowicon:' + exId)
    showToolTipWithIcon(status, exampleIcon.src, exampleMessage.innerHTML, event)
  }
    function showExampleDesc(exId, event) {
        exampleDesc = document.getElementById('rowdesc:' + exId)
        showToolTip('Description', exampleDesc.innerHTML, event)
    }


    </script>
        <script language="javascript">window.onload=init;</script>
        <!-- the tabber.js file must be loaded after the onload function has been set, in order to run the
             tabber code, then the init code -->
        <script type="text/javascript" src="./css/tabber.js"></script> 
        <link href="./css/tabber.css" type="text/css" rel="stylesheet" media="screen"></link> 
    </head>
    <body>
      <div id="breadcrumbs">&gt; <a href="org.specs.mock.mockitoSpec.html">Mockito Specification </a></div>
      <div id="toolTip"></div>
      <a name="top"></a>
      <div id="leftColumn">
     
    </div>
      <div id="bodyColumn">
        <h2>Spies</h2><a name="Spies"></a><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta></head><body><h3 id="Spies">Spies</h3><p>You can create spies of real objects. When you use the spy then the real methods are called (unless a method was stubbed).</br>Real spies should be used carefully and occasionally, for example when dealing with legacy code.</p><p>Spying on real objects is often associated with &quot;partial mocking&quot; concept. However, Mockito spies are not partial mocks. </br>Mockito spy is meant to help testing other classes, not the spy itself. Therefore spy will not help if you intend to verify if method calls other method on the same object. In this case I suggest being OO/SRPy (for example you might extract new class/interface...)</p><p>A spy is created with the <code>spy</code> method: <code class="prettyprint"></code></br><code class="prettyprint"></code></br><code class="prettyprint">  class s extends Specification with Mockito {</code></br><code class="prettyprint">    val spiedList = spy(new LinkedList[String])</code></br><code class="prettyprint">  } </code></p><p><ex onmouseout="hideToolTip();" onmouseover="showExampleDesc('26408345',event)" class="success">You can stub out some methods on a spy</ex>:</p><p><code class="prettyprint">new s { spiedList.size returns 100 }.spiedList.size</code></br>&gt; <code class="prettyprint">res0: Int = 100</code></p><p><ex onmouseout="hideToolTip();" onmouseover="showExampleDesc('32832061',event)" class="success">Then you can call real methods</ex>: <code class="prettyprint"></code></br><code class="prettyprint">                                          </code></br><code class="prettyprint">   val spec = new s                                       </code></br><code class="prettyprint">   spec.spiedList.add(&quot;one&quot;)</code></br><code class="prettyprint">   spec.spiedList.add(&quot;two&quot;) </code></br><code class="prettyprint">   spec.spiedList</code></p><p>&gt; <code class="prettyprint">res3: java.util.LinkedList[String] = [one, two]</code></p><p><ex onmouseout="hideToolTip();" onmouseover="showExampleDesc('24612275',event)" class="success">And you can verify calls</ex>: <code class="prettyprint"></code></br><code class="prettyprint">                                          </code></br><code class="prettyprint">   new s {</code></br><code class="prettyprint">     spiedList.add(&quot;one&quot;)</code></br><code class="prettyprint">     spiedList.add(&quot;one&quot;) was called </code></br><code class="prettyprint">   }.isOk</code></p><p>&gt; <code class="prettyprint">res4: Boolean = true</code></p><p>h.4 Important gotcha on spying real objects!</p><p><ex onmouseout="hideToolTip();" onmouseover="showExampleDesc('8184517',event)" class="success">Sometimes it's impossible to use <code>returns</code> for stubbing spies</ex>. For example: <code class="prettyprint"></code></br><code class="prettyprint">                                          </code></br><code class="prettyprint">   new s {</code></br><code class="prettyprint">     // Impossible: real method is called so spy.get(0) throws IndexOutOfBoundsException (the list is yet empty)</code></br><code class="prettyprint">     spiedList.get(0) returns &quot;one&quot;</code></br><code class="prettyprint">   }.failures</code></p><p>&gt; <code class="prettyprint"></code></br><code class="prettyprint">import org.specs.Specification</code></br><code class="prettyprint">import org.specs.mock.Mockito</code></br><code class="prettyprint">import org.mockito.Mock</code></br><code class="prettyprint">import java.util.List</code></br><code class="prettyprint">import java.util.LinkedList</code></br><code class="prettyprint">defined class s</code></br><code class="prettyprint">java.lang.IndexOutOfBoundsException: Index: 0, Size: 0</code></br><code class="prettyprint">	at java.util.LinkedList.entry(LinkedList.java:365)</code></br><code class="prettyprint">	at java.util.LinkedList.get(LinkedList.java:315)</code></br><code class="prettyprint">	at $java.util.LinkedList$$FastClassByMockitoWithCGLIB$$8ecb7017.invoke(&lt;generated&gt;)</code></br><code class="prettyprint">	at org.mockito.cglib.proxy.MethodProxy.invoke(MethodProxy.java:191)</code></br><code class="prettyprint">	at org.mockito.internal.MockHandler.intercept(MockHandler.java:97)</code></br><code class="prettyprint">	at org....</code></p><p><ex onmouseout="hideToolTip();" onmouseover="showExampleDesc('12047823',event)" class="success">You have to use <code>doReturn</code> for stubbing</ex><code class="prettyprint"></code></br><code class="prettyprint">   new s {</code></br><code class="prettyprint">     doReturn(&quot;one&quot;).when(spiedList).get(0)</code></br><code class="prettyprint">   }.spiedList.get(0)</code></br>&gt; <code class="prettyprint">res6: String = one</code></p></body></html><h3><img onclick="toggleImage(this); showHideTable('sus:20320142')" src="images/collapsed.gif"></img>Examples summary</h3><div style="display:none" id="sus:20320142">
          <table class="bodyTable">
             <tr class="b">
      <td id="rowdesc:26408345"><img src="images/icon_success_sml.gif" id="rowicon:26408345"></img> <t>You can stub out some methods on a spy</t></td>
    </tr><tr class="a">
      <td id="rowdesc:32832061"><img src="images/icon_success_sml.gif" id="rowicon:32832061"></img> <t>Then you can call real methods</t></td>
    </tr><tr class="b">
      <td id="rowdesc:24612275"><img src="images/icon_success_sml.gif" id="rowicon:24612275"></img> <t>And you can verify calls</t></td>
    </tr><tr class="a">
      <td id="rowdesc:8184517"><img src="images/icon_success_sml.gif" id="rowicon:8184517"></img> <t>Sometimes it's impossible to use <code>returns</code> for stubbing spies</t></td>
    </tr><tr class="b">
      <td id="rowdesc:12047823"><img src="images/icon_success_sml.gif" id="rowicon:12047823"></img> <t>You have to use <code>doReturn</code> for stubbing</t></td>
    </tr>
          </table>
        </div>
      </div>
    </body>
  </html>